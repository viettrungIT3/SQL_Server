CREATE DATABASE QLBanHang

USE QLBanHang
GO

CREATE TABLE VATTU 
(
	MAVTU CHAR(4) PRIMARY KEY,
	TENVTU NVARCHAR(100) UNIQUE NOT NULL,
	DVTINH NVARCHAR(10) DEFAULT NOT NULL,
	PHANTRAM REAL CHECK( PHANTRAM >= 0 AND PHANTRAM <= 100)
)
GO
CREATE TABLE NHACC
(
	MANHACC CHAR(3) PRIMARY KEY,
	TENHACC NVARCHAR(100) NOT NULL,
	DIACHIA NVARCHAR(200) NOT NULL,
	DIENTHOAI VARCHAR(20)
)
GO
CREATE TABLE DONDH
(
	SODH CHAR(4) PRIMARY KEY,
	NGAYDH DATETIME,
	MANHACC CHAR(3),
	FOREIGN KEY (MANHACC) REFERENCES dbo.NHACC(MANHACC)
)
GO
CREATE TABLE CTDONDH
(
	SODH CHAR(4) NOT NULL,
	MAVATU CHAR(4) NOT NULL,
	SLDAT INT,
	PRIMARY KEY (SODH, MAVATU),
	FOREIGN KEY (SODH) REFERENCES dbo.DONDH(SODH),
	FOREIGN KEY (MAVATU) REFERENCES dbo.VATTU(MAVTU)
)
GO
CREATE TABLE PNHAP
(
	SOPN CHAR(4) PRIMARY KEY,
	NGAYNHAP DATETIME,
	SODH CHAR(4) NOT NULL,
	FOREIGN KEY (SODH) REFERENCES dbo.DONDH(SODH)
)
GO
CREATE TABLE CTPNHAP
(
	SOPN CHAR(4) NOT NULL,
	MAVTU CHAR(4) NOT NULL,
	SLNHAP INT,
	DGNHAP MONEY,
	PRIMARY KEY (SOPN,MAVTU),
	FOREIGN KEY (SOPN) REFERENCES dbo.PNHAP(SOPN),
	FOREIGN KEY (MAVTU) REFERENCES dbo.VATTU(MAVTU)
)
GO
CREATE TABLE PXUAT
(
	SOPX CHAR(4) PRIMARY KEY,
	NGAYXUAT DATETIME,
	TENKH NVARCHAR(100) NOT NULL
)
GO
CREATE TABLE CTPXUAT
(
	SOPX CHAR(4) NOT NULL,
	MAVTU CHAR(4) NOT NULL,
	SLXUAT INT,
	DGXUAT MONEY,
	PRIMARY KEY (SOPX,MAVTU),
	FOREIGN KEY (SOPX) REFERENCES dbo.PXUAT(SOPX),
	FOREIGN KEY (MAVTU) REFERENCES dbo.VATTU(MAVTU)
)
GO
CREATE TABLE TONKHO
(
	NAMTHANG CHAR(6) PRIMARY KEY,
	MAVTU CHAR(4) NOT NULL,
	SLDAU INT,
	TONGSLN INT,
	TONGSLX INT,
	SLCUOI AS SLDAU + TONGSLN - TONGSLX,
	FOREIGN KEY (MAVTU) REFERENCES dbo.VATTU(MAVTU)
)

INSERT INTO dbo.NHACC VALUES(   'C01', N'Nguyễn Minh Trí', N'54 hậu Giang Q6 HCM', '8781024')
INSERT INTO dbo.NHACC VALUES(   'C02', N'Trần Minh Thạch', N'145 Hùng Vương Mỹ Tho', '7698154')
INSERT INTO dbo.NHACC VALUES(   'C03', N'Hồng Phương', N'154/40 Lê Lai Q1 HCM', '9600125')
INSERT INTO dbo.NHACC VALUES(   'C04', N'Nhật Thắng', N'198/40 Hương Lộ 14 QTB HCM', '8757757')
INSERT INTO dbo.NHACC VALUES(   'C05', N'Lưu Nguyệt Huế', N'178 Nguyễn Văn Long Đà Lạt', '7964251')
INSERT INTO dbo.NHACC VALUES(   'C07', N'Cao Minh Trung', N'125 Lê Quang Sung Nha Trang', '')

--SELECT * FROM dbo.NHACC

INSERT INTO DONDH VALUES(	'D001', '20050115', 'C03')
INSERT INTO DONDH VALUES(	'D002',	'20050130',	'C01')
INSERT INTO DONDH VALUES(	'D003', '20050210', 'C02')
INSERT INTO DONDH VALUES(	'D004', '20050217', 'C05')
INSERT INTO DONDH VALUES(	'D005',	'20050301', 'C02')
INSERT INTO DONDH VALUES(	'D006', '20050312', 'C05')

--SELECT * FROM dbo.DONDH
	
INSERT INTO PNHAP VALUES(	'N001',	'20050117', 'D001')
INSERT INTO PNHAP VALUES(	'N002', '20050120',	'D001')
INSERT INTO PNHAP VALUES(	'N003',	'20050131',	'D002')
INSERT INTO PNHAP VALUES(	'N004', '20050215', 'D003')

INSERT INTO VATTU VALUES( 'DD01', N'Đồ dùng 1', 6, 95)
INSERT INTO VATTU VALUES( 'DD02', N'Đồ dùng 2', 5 , 90)
INSERT INTO VATTU VALUES( 'VD02', N'Vật dụng 2', 8, 90)
INSERT INTO VATTU VALUES( 'TV12', N'Tivi 12', 100, 99)
INSERT INTO VATTU VALUES( 'DD05', N'Đá', 100, 99)
INSERT INTO VATTU VALUES( 'DD06', N'Thep', 500, 99)

SELECT * FROM dbo.VATTU

INSERT INTO CTDONDH VALUES (	'D001', 'DD01',	10)
INSERT INTO CTDONDH VALUES (	'D001',	'DD02', 15)

SELECT * FROM dbo.CTDONDH

